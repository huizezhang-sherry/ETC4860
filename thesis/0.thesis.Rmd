---
title: "0.Thesis"
author: "Huize Zhang"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    toc: true
    fig_caption: yes
editor_options: 
  chunk_output_type: console
bibliography: 0.ref_2.bib
csl: apa.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(boot)
library(broom)

load("../raw_data/au_imputed.rda")
```


# Data structure

The rest of the project focuses on the action unit related variables. If we write all the information in the matrix notation, every element will have four indices: 

- $i$ for `judge_id`; 
- $j$ for `video_id`; 
- $t$ for `frame_id` and 
- $k$ for `au_id`. 

Using the tidy principle, the data is in a tsibble format with `index = frame_id` and `key = c("judge_id, video_id)`. Different measurements on the presence and intensity of each action units are the variables. Assuming all the facial information can be summarised as a `Y` variable with multiple indices `(i,j,t,k)`. We can summarise the information via a linear combination of variables as 


$$Y_{ijtk} = \mu + \alpha_i + \beta_j + \gamma_t + \delta_k + CP_2(\alpha_i, \beta_j, \gamma_t, \delta_k) + CP_3(\alpha_i, \beta_j, \gamma_t, \delta_k)$$

where

- $i$ is the judge_id index and $i = 1, 2, \cdots, I$
- $j$ is the video_id index and $j = 1, 2, \cdots, J$
- $t$ is the time index and $t = 1, 2, \cdots, T_J$
- $k$ is the index for the available action unit in this project and $k = 1, 2, \cdots, K$
- $CP_2$ is the all possible interaction of the two variables
- $CP_3$ is the all possible interaction of the three variables



# Action Unit across the Justices

Apart from understand how each Justice behaves consistently or not across all the videos, we are also interested in comparing *across* all the Justices to study who are more animated than others during the hearings. In this piece of analysis we perform a principle component analysis (PCA) on two set of variables. Variables in the form of `AU**_r` represents the intensity of each AU, which takes value from 0 to 5. The other set of variable: `AU**_c` represents the binary presence or not of each AU. Time index is averaged for each judge and video pair and mathmetically, it can be summarised as follows. 

\begin{align}
\begin{bmatrix}
x_{1,1,\bar{t},1} & x_{1,1,\bar{t},2} & \cdots & x_{1,1,\bar{t},K}\\
x_{1,2,\bar{t},1} & x_{1,2,\bar{t},2} & \cdots & x_{1,2,\bar{t},K}\\
\vdots & \vdots & &\vdots\\
x_{1,J,\bar{t},1} & x_{1,J,\bar{t},2} & \cdots & x_{1,2,\bar{t},K}\\
x_{2,1,\bar{t},1} & x_{2,1,\bar{t},2} & \cdots & x_{2,1,\bar{t},K}\\
\vdots & \vdots & &\vdots\\
x_{I,J,\bar{t},1} & x_{I,J,\bar{t},2} & \cdots & x_{I,J,\bar{t},K}
\end{bmatrix}
\end{align}

## Result 
The scree plot and variable plot are shown in Figure \ref{fig:pca_var_explained} and \ref{fig:pca_impt} repsectively. The variable plot presents the loading of each variable in the first two components. The important variables are the ones with large loadings in the absoluate value and have been summarised into the following table. Visualisation of the first two fitted PCs can be found in Figure \ref{fig:pca_vis}. It shows that the Justices Nettle and Kiefel has high projection on the first principle component and Justices Bell has high projection on the second principle component. 

|PC#| Presence  |Intensity|
|---|----------|----------|
|PC1|AU05_c, AU45_c|AU06_r, AU09_r,AU17_r, AU45_r|
|PC2|AU05_c, AU09_c,AU25_c|AU04_r, AU06_r, AU09_r, AU17_r|

### Who is the most animated judge
The PCA study can help us to answer the following question: Who is the most animated judge? Since PCs are linear combination of the original variables, @chao2017principal proposed to take the absolute value of the fitted PCs and compute the sum to create an index. In this study, the first two fitted PCs are summed to determine the most animated judge and I find that Justices Bell is the most animated, then followed by the Chief Justices Kiefel and Justices Nettle. Edelman and Keane are the most nutural Justices. 

\newpage

# Appendix 

```{r echo = FALSE}
summarised_mean <- au_imputed %>% 
  select(-speaker, -frame_id) %>% 
  group_by(judge_id, video_id) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  filter(AU01_c != "NaN") # filter out possible judge-video combination
  
pca_data <- summarised_mean %>%   
  ungroup() %>%
  select(-judge_id, -video_id)

pca_model <- pca_data %>%
  nest() %>% 
  mutate(model = map(data, ~prcomp(.x)))
```

```{r pca_scree, echo = FALSE, fig.height=4, fig.width=5, fig.align="center", fig.cap="Scree plot for cummulative variance explained by the PCs.\\label{fig:pca_var_explained}"}
# vis: variance explained: top 10 PCs explains 94.5% of the variance - happy with that
pca_model$model %>%
  map_df(~tidy(.x, data = .y, "pcs")) %>%
  ggplot(aes(x = PC, y = cumulative)) +
  geom_line() +
  geom_point()

pca_aug <- pca_model %>% 
  mutate(pca_aug = map2(model, data, ~augment(.x, data = .y))) %>%
  unnest(pca_aug) %>% 
  bind_cols(summarised_mean[, 1:2]) 
```

```{r pca_impt, echo = FALSE, fig.height = 4, fig.width=5, fig.align="center", fig.cap = "Visualisation of the variable importance in the first two PCs.\\label{fig:pca_impt}"}
# Most important variables
library(factoextra)
fviz_pca_var(prcomp(pca_data),
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE     # Avoid text overlapping
             )
# weight
# pca_model$model[[1]]$rotation %>% 
#   as_tibble() %>% 
#   bind_cols(AU = colnames(pca_data)) %>% 
#   arrange(PC1, PC2) %>% 
#   select(AU, PC1, PC2)
```

```{r pca_vis, echo = FALSE, fig.height=4, fig.width=5, fig.align="center", fig.cap="Visualisation of the first and second principle component.\\label{fig:pca_vis}"}
# PCA vis
pca_aug %>% 
  ggplot(aes(x = .fittedPC1, y = .fittedPC2, col = judge_id)) + 
  geom_point() 
```

```{r most_animated, echo = FALSE, fig.height=4, fig.width=5, fig.align="center", fig.cap = "The most animated judge by adding up the first two principle components.\\label{fig:most_animated}"}
# Most animated judge
most_animated_judge <- pca_aug %>% 
  select(.fittedPC1: .fittedPC10) %>% 
  as.matrix() %>% 
  abs() %>% 
  as.data.frame() %>% 
  bind_cols(judge_id = pca_aug$judge_id, 
            video_id = pca_aug$video_id) %>% 
  group_by(judge_id) %>% 
  summarise_all(mean) %>% # summarise into one judge per row (from one judge*video per row)
  ungroup() %>% 
  mutate(index = select(., .fittedPC1: .fittedPC2) %>% rowSums()) %>% 
  select(judge_id, index) %>% 
  arrange(desc(index))

most_animated_judge %>% 
  ggplot(aes(x = fct_reorder(judge_id, desc(index)), 
             y = index, col = index, fill = index)) + 
  geom_bar(stat = "identity") + 
  xlab("judge") + 
  ggtitle("Who is the most animated judge?")
```

\newpage
# Reference